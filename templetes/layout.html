<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Web Interview Prep{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    {% block head %}{% endblock %}
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand logo-large" href="{{ url_for('index') }}">
                <i class="fas fa-laptop-code me-2"></i>WEB-INTER-PREP
            </a>
            <div class="d-flex align-items-center">
                <!-- Direct Nav Links -->
                <div class="direct-nav me-3">
                    <a href="{{ url_for('index') }}" class="btn btn-dark nav-btn">
                        <i class="fas fa-home me-2"></i>Home
                    </a>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-dark nav-btn">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                </div>

                <!-- More Dropdown -->
                <div class="dropdown me-3">
                    <button class="btn btn-dark dropdown-toggle" type="button" id="moreDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-ellipsis-h me-1"></i> More
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="moreDropdown">
                        <li>
                            <h6 class="dropdown-header">
                                <i class="fas fa-star me-2"></i>Features
                            </h6>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('company_prep') }}">
                                <i class="fas fa-building me-2 text-primary"></i>Company Prep
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('ai_interview') }}">
                                <i class="fas fa-robot me-2 text-info"></i>AI Interview
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('english_booster') }}">
                                <i class="fas fa-rocket me-2 text-warning"></i>English Booster
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('avatar_interview') }}">
                                <i class="fas fa-user-tie me-2 text-success"></i>Avatar Interview
                            </a>
                        </li>

                        {% if 'user_id' in session %}
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <h6 class="dropdown-header">
                                <i class="fas fa-tools me-2"></i>Tools
                            </h6>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('resume_template') }}">
                                <i class="fas fa-file-alt me-2 text-secondary"></i>Resume
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('interview_progress') }}">
                                <i class="fas fa-calendar me-2 text-danger"></i>Calendar
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('dsa') }}">
                                <i class="fas fa-code me-2 text-dark"></i>DSA Practice
                            </a>
                        </li>
                        {% endif %}

                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <h6 class="dropdown-header">
                                <i class="fas fa-graduation-cap me-2"></i>Learning
                            </h6>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('resources') }}">
                                <i class="fas fa-book me-2 text-info"></i>Resources
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{{ url_for('career_roadmap') }}">
                                <i class="fas fa-road me-2 text-success"></i>Career Roadmap
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Authentication Controls -->
                <div class="auth-controls">
                    {% if 'user_id' in session %}
                    <a class="btn btn-outline-light btn-sm" href="{{ url_for('logout') }}" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                    {% else %}
                    <a class="btn btn-outline-light btn-sm me-2" href="{{ url_for('login') }}">
                        <i class="fas fa-sign-in-alt me-1"></i> Login
                    </a>
                    <a class="btn btn-outline-light btn-sm" href="{{ url_for('register') }}">
                        <i class="fas fa-user-plus me-1"></i> Register
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} d-flex align-items-center">
            <i class="fas {% if category == 'success' %}fa-check-circle
                                    {% elif category == 'danger' %}fa-exclamation-circle
                                    {% elif category == 'warning' %}fa-exclamation-triangle
                                    {% else %}fa-info-circle{% endif %} me-2"></i>
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h3><i class="fas fa-envelope me-2"></i>Contact Us</h3>
                    <p><i class="fas fa-envelope me-2"></i>support@webinterprep.com</p>
                    <p><i class="fas fa-phone me-2"></i>+123 456 7890</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h3><i class="fas fa-share-alt me-2"></i>Follow Us</h3>
                    <p>
                        <a href="#" class="text-white me-3"><i class="fab fa-facebook me-1"></i>Facebook</a>
                        <a href="#" class="text-white me-3"><i class="fab fa-twitter me-1"></i>Twitter</a>
                        <a href="#" class="text-white"><i class="fab fa-linkedin me-1"></i>LinkedIn</a>
                    </p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col text-center">
                    <p><i class="far fa-copyright me-2"></i>2025 Web Interview Prep. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Dropdown Fix Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Wait for Bootstrap to be fully loaded
            setTimeout(function () {
                try {
                    // Ensure Bootstrap dropdowns are properly initialized
                    var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
                    var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
                        return new bootstrap.Dropdown(dropdownToggleEl);
                    });

                    console.log('Bootstrap dropdowns initialized:', dropdownList.length);

                    // Debug: Log when dropdown is opened
                    var moreDropdown = document.getElementById('moreDropdown');
                    if (moreDropdown) {
                        moreDropdown.addEventListener('show.bs.dropdown', function () {
                            console.log('More dropdown is opening');
                        });

                        moreDropdown.addEventListener('shown.bs.dropdown', function () {
                            console.log('More dropdown is now visible');
                        });
                    }
                } catch (error) {
                    console.error('Error initializing dropdowns:', error);

                    // Fallback: Manual dropdown toggle
                    var moreBtn = document.getElementById('moreDropdown');
                    var dropdownMenu = moreBtn.nextElementSibling;

                    moreBtn.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();

                        // Toggle dropdown visibility
                        if (dropdownMenu.classList.contains('show')) {
                            dropdownMenu.classList.remove('show');
                        } else {
                            // Close other dropdowns
                            document.querySelectorAll('.dropdown-menu.show').forEach(function (menu) {
                                menu.classList.remove('show');
                            });

                            // Position dropdown correctly
                            dropdownMenu.style.position = 'absolute';
                            dropdownMenu.style.top = '100%';
                            dropdownMenu.style.right = '0';
                            dropdownMenu.style.left = 'auto';
                            dropdownMenu.style.zIndex = '9999';
                            dropdownMenu.style.transform = 'none';

                            dropdownMenu.classList.add('show');
                        }
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', function (e) {
                        if (!moreBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                            dropdownMenu.classList.remove('show');
                        }
                    });
                }
            }, 100);
        });
    </script>

    <!-- Global Error Handler -->
    <script>
        // Global error handling for async listener issues
        window.addEventListener('unhandledrejection', function (event) {
            // Suppress browser extension async listener errors
            if (event.reason && event.reason.message &&
                (event.reason.message.includes('message channel closed') ||
                    event.reason.message.includes('Extension context invalidated'))) {
                event.preventDefault();
                console.log('Browser extension error suppressed:', event.reason.message);
                return;
            }
        });

        // Global error handler for runtime errors
        window.addEventListener('error', function (event) {
            // Suppress Chrome extension errors that don't affect functionality
            if (event.message &&
                (event.message.includes('Extension context invalidated') ||
                    event.message.includes('message channel closed') ||
                    event.message.includes('chrome-extension://'))) {
                event.preventDefault();
                return false;
            }
        });

        // Console override to reduce noise from extension errors
        const originalConsoleError = console.error;
        console.error = function (...args) {
            const message = args.join(' ');
            if (message.includes('Extension context invalidated') ||
                message.includes('message channel closed') ||
                message.includes('chrome-extension://')) {
                return; // Don't log extension errors
            }
            originalConsoleError.apply(console, args);
        };
    </script>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    {% block scripts %}{% endblock %}

</body>

</html>